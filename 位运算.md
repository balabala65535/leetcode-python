# 位运算及其算法应用场景

位运算是对二进制数直接进行操作的运算方式，它们在计算机科学中非常重要，因为计算机底层就是以二进制形式处理数据的。位运算通常比算术运算更快，因此在性能敏感的场景中非常有用。

## 基本位运算符

### 1. 按位与 (AND, &)
- **定义**：两个操作数的对应位都为1时，结果的该位才为1，否则为0
- **示例**：`5 & 3` (0101 & 0011) = 0001 (1)

**使用场景**：
- 检查奇偶性：`x & 1` (结果为1是奇数，0是偶数)
- 掩码操作：提取特定位，如获取低8位 `x & 0xFF`
- 判断是否是2的幂：`(x & (x - 1)) == 0`

### 2. 按位或 (OR, |)
- **定义**：两个操作数的对应位有一个为1时，结果的该位就为1
- **示例**：`5 | 3` (0101 | 0011) = 0111 (7)

**使用场景**：
- 设置特定位为1
- 合并多个标志位
- 在图形编程中合并颜色值

### 3. 按位异或 (XOR, ^)
- **定义**：两个操作数的对应位不同时，结果的该位为1，否则为0
- **示例**：`5 ^ 3` (0101 ^ 0011) = 0110 (6)

**使用场景**：
- 交换两个数：`a ^= b; b ^= a; a ^= b;`
- 加密算法
- 找出现一次的数字（其他数字都出现两次）
- 格雷码生成

### 4. 按位取反 (NOT, ~)
- **定义**：操作数的每一位取反
- **示例**：`~5` (~0101) = 1010 (在32位系统中是-6的补码表示)

**使用场景**：
- 创建掩码
- 位反转操作
- 在某些加密算法中

### 5. 左移 (<<)
- **定义**：将操作数的所有位向左移动指定位数，右侧补0
- **示例**：`5 << 1` (0101 << 1) = 1010 (10)

**使用场景**：
- 快速乘以2的幂：`x << n` 相当于 `x * 2ⁿ`
- 位图操作中设置位
- 哈希算法中的位混合

### 6. 右移 (>>)
- **定义**：将操作数的所有位向右移动指定位数，左侧补符号位（算术右移）或0（逻辑右移，取决于语言）
- **示例**：`5 >> 1` (0101 >> 1) = 0010 (2)

**使用场景**：
- 快速除以2的幂：`x >> n` 相当于 `x / 2ⁿ`
- 提取高位数据
- 在某些压缩算法中

## 高级位运算技巧及应用

### 1. 位操作技巧
- **设置第n位为1**：`x | (1 << n)`
- **清除第n位（设为0）**：`x & ~(1 << n)`
- **切换第n位**：`x ^ (1 << n)`
- **检查第n位是否为1**：`(x >> n) & 1`
- **最低位的1变为0**：`x & (x - 1)`
- **获取最低位的1**：`x & -x`

### 2. 算法应用场景

#### a) 位掩码与状态压缩
- **子集生成**：使用n位二进制数表示n个元素的子集
- **N皇后问题**：用位运算加速冲突检测
- **动态规划状态压缩**：如旅行商问题(TSP)中表示已访问城市

#### b) 快速计算
- **快速幂算法**：使用位运算分解指数
- **哈希函数**：如布隆过滤器使用多个位运算哈希
- **CRC校验**：使用位运算进行多项式除法

#### c) 图形处理
- **颜色混合**：ARGB颜色值的位操作
- **图像处理**：如位图操作、像素处理

#### d) 网络与编码
- **IP地址处理**：子网掩码计算
- **数据压缩**：如哈夫曼编码的位操作
- **协议字段解析**：从字节中提取特定比特位

#### e) 加密算法
- **AES、DES等对称加密**：使用大量位运算
- **随机数生成**：线性反馈移位寄存器(LFSR)

#### f) 位图与集合操作
- **布隆过滤器**：使用多个位运算哈希函数
- **快速集合操作**：并集(|)、交集(&)、差集(&~)

## 实际代码示例

### 1. 判断是否是2的幂
```python
def is_power_of_two(x):
    return x > 0 and (x & (x - 1)) == 0
```

### 2. 计算汉明重量（二进制中1的个数）
```python
def hamming_weight(x):
    count = 0
    while x:
        x &= x - 1
        count += 1
    return count
```

### 3. 不使用临时变量交换两个数
```python
a ^= b
b ^= a
a ^= b
```

### 4. 找出只出现一次的数字（其他都出现两次）
```python
def single_number(nums):
    res = 0
    for num in nums:
        res ^= num
    return res
```

位运算虽然强大，但可读性较差，使用时应当添加适当注释说明其意图。