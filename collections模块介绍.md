# **Python `collections` æ¨¡å—è¯¦è§£**

`collections` æ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œæä¾›äº†è®¸å¤š**é«˜æ€§èƒ½ã€ä¸“ç”¨çš„å®¹å™¨æ•°æ®ç±»å‹**ï¼Œç”¨äºæ›¿ä»£ Python å†…ç½®çš„é€šç”¨å®¹å™¨ï¼ˆå¦‚ `list`ã€`dict`ã€`tuple` ç­‰ï¼‰ã€‚è¿™äº›æ•°æ®ç»“æ„åœ¨ç‰¹å®šåœºæ™¯ä¸‹èƒ½æ˜¾è‘—æå‡ä»£ç æ•ˆç‡å’Œå¯è¯»æ€§ã€‚

---

## **1. `collections` æ¨¡å—çš„æ ¸å¿ƒæ•°æ®ç»“æ„**
ä»¥ä¸‹æ˜¯ `collections` ä¸­æœ€å¸¸ç”¨çš„ 5 ä¸ªç±»ï¼š

| ç±»å | ç”¨é€” | æ›¿ä»£çš„å†…ç½®ç±»å‹ |
|------|------|--------------|
| `defaultdict` | å¸¦é»˜è®¤å€¼çš„å­—å…¸ | `dict` |
| `Counter` | è®¡æ•°å™¨ï¼ˆç»Ÿè®¡é¢‘ç‡ï¼‰ | `dict` + æ‰‹åŠ¨è®¡æ•° |
| `deque` | åŒç«¯é˜Ÿåˆ—ï¼ˆé«˜æ•ˆæ’å…¥/åˆ é™¤ï¼‰ | `list` |
| `namedtuple` | å‘½åå…ƒç»„ï¼ˆå¢å¼ºç‰ˆ `tuple`ï¼‰ | `tuple` |
| `OrderedDict` | æœ‰åºå­—å…¸ï¼ˆPython 3.7+ æ™®é€š `dict` å·²æœ‰åºï¼‰ | `dict` |

---

## **2. è¯¦ç»†åŠŸèƒ½ä»‹ç»**

### **(1) `defaultdict`ï¼šå¸¦é»˜è®¤å€¼çš„å­—å…¸**
- **ä½œç”¨**ï¼šå½“è®¿é—®ä¸å­˜åœ¨çš„é”®æ—¶ï¼Œè‡ªåŠ¨åˆå§‹åŒ–é»˜è®¤å€¼ï¼ˆé¿å… `KeyError`ï¼‰ã€‚
- **å…¸å‹ç”¨é€”**ï¼šç»Ÿè®¡è¯é¢‘ã€åˆ†ç»„æ•°æ®ã€‚

```python
from collections import defaultdict

# ç¤ºä¾‹1ï¼šç»Ÿè®¡å•è¯é¢‘ç‡
words = ["apple", "banana", "apple", "orange"]
word_count = defaultdict(int)  # é»˜è®¤å€¼ 0
for word in words:
    word_count[word] += 1
print(word_count)  # è¾“å‡º: defaultdict(<class 'int'>, {'apple': 2, 'banana': 1, 'orange': 1})

# ç¤ºä¾‹2ï¼šåˆ†ç»„æ•°æ®ï¼ˆæ¯” setdefault æ›´é«˜æ•ˆï¼‰
anagrams = defaultdict(list)
for word in ["eat", "tea", "tan"]:
    key = ''.join(sorted(word))
    anagrams[key].append(word)
print(anagrams)  # è¾“å‡º: defaultdict(<class 'list'>, {'aet': ['eat', 'tea'], 'ant': ['tan']})
```

---

### **(2) `Counter`ï¼šè®¡æ•°å™¨**
- **ä½œç”¨**ï¼šå¿«é€Ÿç»Ÿè®¡å¯è¿­ä»£å¯¹è±¡ä¸­å…ƒç´ çš„é¢‘ç‡ã€‚
- **å…¸å‹ç”¨é€”**ï¼šç»Ÿè®¡è¯é¢‘ã€æ‰¾Top Nå…ƒç´ ã€‚

```python
from collections import Counter

# ç¤ºä¾‹1ï¼šç»Ÿè®¡å­—ç¬¦é¢‘ç‡
count = Counter("abracadabra")
print(count)  # Counter({'a': 5, 'b': 2, 'r': 2, 'c': 1, 'd': 1})

# ç¤ºä¾‹2ï¼šæ‰¾å‡ºç°æ¬¡æ•°æœ€å¤šçš„2ä¸ªå…ƒç´ 
print(count.most_common(2))  # [('a', 5), ('b', 2)]

# ç¤ºä¾‹3ï¼šåˆå¹¶è®¡æ•°å™¨
count2 = Counter("hello")
print(count + count2)  # Counter({'a': 5, 'b': 3, 'r': 2, 'l': 2, 'h': 1, 'e': 1, 'c': 1, 'd': 1, 'o': 1})
```

---

### **(3) `deque`ï¼šåŒç«¯é˜Ÿåˆ—**
- **ä½œç”¨**ï¼šé«˜æ•ˆå®ç°é˜Ÿåˆ—ï¼ˆFIFOï¼‰å’Œæ ˆï¼ˆLIFOï¼‰ï¼Œæ”¯æŒä¸¤ç«¯å¿«é€Ÿæ’å…¥/åˆ é™¤ã€‚
- **å…¸å‹ç”¨é€”**ï¼šBFSç®—æ³•ã€æ»‘åŠ¨çª—å£ã€å†å²è®°å½•ã€‚

```python
from collections import deque

# ç¤ºä¾‹1ï¼šé˜Ÿåˆ—æ“ä½œï¼ˆæ¯” list.pop(0) å¿«ï¼‰
q = deque([1, 2, 3])
q.append(4)    # å³ç«¯æ’å…¥
q.popleft()    # å·¦ç«¯åˆ é™¤ï¼ˆè¾“å‡º: 1ï¼‰

# ç¤ºä¾‹2ï¼šæ ˆæ“ä½œ
stack = deque()
stack.append(1)  # å‹æ ˆ
stack.pop()      # å¼¹æ ˆï¼ˆè¾“å‡º: 1ï¼‰

# ç¤ºä¾‹3ï¼šå›ºå®šé•¿åº¦é˜Ÿåˆ—ï¼ˆè‡ªåŠ¨ä¸¢å¼ƒæ—§æ•°æ®ï¼‰
d = deque(maxlen=3)
d.extend([1, 2, 3])
d.append(4)  # è‡ªåŠ¨ä¸¢å¼ƒ1
print(d)     # deque([2, 3, 4], maxlen=3)
```

---

### **(4) `namedtuple`ï¼šå‘½åå…ƒç»„**
- **ä½œç”¨**ï¼šåˆ›å»ºå¸¦æœ‰å­—æ®µåçš„å…ƒç»„ï¼ˆç±»ä¼¼è½»é‡çº§ç±»ï¼‰ã€‚
- **å…¸å‹ç”¨é€”**ï¼šæ›¿ä»£ç®€å•ç±»ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚

```python
from collections import namedtuple

# å®šä¹‰å‘½åå…ƒç»„
Point = namedtuple("Point", ["x", "y"])
p = Point(1, 2)

# è®¿é—®å­—æ®µ
print(p.x, p.y)  # 1 2
print(p[0], p[1])  # 1 2ï¼ˆä»æ”¯æŒç´¢å¼•ï¼‰

# è½¬æ¢ä¸ºå­—å…¸
print(p._asdict())  # {'x': 1, 'y': 2}
```

---

### **(5) `OrderedDict`ï¼šæœ‰åºå­—å…¸**
- **ä½œç”¨**ï¼šä¿æŒé”®çš„æ’å…¥é¡ºåºï¼ˆPython 3.7+ æ™®é€š `dict` å·²æœ‰åºï¼Œæ­¤ç±»ä¸»è¦ç”¨äºæ—§ç‰ˆæœ¬ï¼‰ã€‚
- **å…¸å‹ç”¨é€”**ï¼šéœ€è¦ä¿æŒé¡ºåºçš„å­—å…¸æ“ä½œã€‚

```python
from collections import OrderedDict

d = OrderedDict()
d["a"] = 1
d["b"] = 2
print(d)  # OrderedDict([('a', 1), ('b', 2)])

# æœ€åæ’å…¥çš„é”®ç§»åˆ°æœ«å°¾
d.move_to_end("a")
print(d)  # OrderedDict([('b', 2), ('a', 1)])
```

---

## **3. å…¶ä»–å®ç”¨å·¥å…·**
- **`ChainMap`**ï¼šåˆå¹¶å¤šä¸ªå­—å…¸ï¼ˆé€»è¾‘åˆå¹¶ï¼Œä¸åˆ›å»ºæ–°å­—å…¸ï¼‰ã€‚
- **`UserDict`/`UserList`/`UserString`**ï¼šæ–¹ä¾¿è‡ªå®šä¹‰å®¹å™¨ç±»ã€‚

```python
from collections import ChainMap

dict1 = {"a": 1}
dict2 = {"b": 2}
combined = ChainMap(dict1, dict2)
print(combined["a"])  # 1ï¼ˆä¼˜å…ˆè®¿é—® dict1ï¼‰
```

---

## **4. æ€»ç»“**
| æ•°æ®ç»“æ„ | æ ¸å¿ƒä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ |
|----------|---------|----------|
| `defaultdict` | é¿å… `KeyError` | åˆ†ç»„ã€ç»Ÿè®¡ |
| `Counter` | å¿«é€Ÿè®¡æ•° | è¯é¢‘åˆ†æã€Top N |
| `deque` | é«˜æ•ˆä¸¤ç«¯æ“ä½œ | é˜Ÿåˆ—ã€æ ˆã€BFS |
| `namedtuple` | å­—æ®µåè®¿é—® | æ›¿ä»£ç®€å•ç±» |
| `OrderedDict` | ä¿æŒæ’å…¥é¡ºåº | æ—§ç‰ˆæœ¬ Python æœ‰åºå­—å…¸ |

**ä½¿ç”¨å»ºè®®**ï¼š
- éœ€è¦ç»Ÿè®¡é¢‘ç‡ â†’ `Counter`
- éœ€è¦åˆ†ç»„æ•°æ® â†’ `defaultdict`
- éœ€è¦é«˜æ•ˆé˜Ÿåˆ—/æ ˆ â†’ `deque`
- éœ€è¦æ›´å¯è¯»çš„å…ƒç»„ â†’ `namedtuple`

`collections` æ¨¡å—èƒ½æ˜¾è‘—æå‡ä»£ç æ€§èƒ½å’Œå¯è¯»æ€§ï¼Œå»ºè®®ç†Ÿç»ƒæŒæ¡ï¼ ğŸš€

---
# **é˜Ÿåˆ—ï¼ˆQueueï¼‰å’Œæ ˆï¼ˆStackï¼‰çš„åŒºåˆ«**

é˜Ÿåˆ—å’Œæ ˆæ˜¯ä¸¤ç§å¸¸ç”¨çš„**çº¿æ€§æ•°æ®ç»“æ„**ï¼Œå®ƒä»¬åœ¨æ•°æ®å­˜å–æ–¹å¼ä¸Šæœ‰æœ¬è´¨åŒºåˆ«ï¼š

| ç‰¹æ€§          | é˜Ÿåˆ— (Queue)               | æ ˆ (Stack)                |
|---------------|---------------------------|--------------------------|
| **æ•°æ®å­˜å–è§„åˆ™** | **å…ˆè¿›å…ˆå‡º (FIFO)**        | **åè¿›å…ˆå‡º (LIFO)**       |
| **æ“ä½œç«¯**     | ä¸¤ç«¯æ“ä½œï¼ˆé˜Ÿå°¾å…¥ï¼Œé˜Ÿé¦–å‡ºï¼‰ | å•ç«¯æ“ä½œï¼ˆæ ˆé¡¶å…¥ï¼Œæ ˆé¡¶å‡ºï¼‰ |
| **ç±»æ¯”ç°å®**   | æ’é˜Ÿä¹°ç¥¨ï¼ˆå…ˆåˆ°å…ˆå¾—ï¼‰       | å ç›˜å­ï¼ˆæœ€åæ”¾çš„å…ˆå–ï¼‰     |
| **å…¸å‹ç”¨é€”**   | BFSç®—æ³•ã€ä»»åŠ¡è°ƒåº¦          | å‡½æ•°è°ƒç”¨ã€æ‹¬å·åŒ¹é…         |
| **Pythonå®ç°** | `collections.deque`        | ç›´æ¥ç”¨ `list` æˆ– `deque`  |

---

## **1. æ ¸å¿ƒåŒºåˆ«è¯¦è§£**
### **(1) æ•°æ®å­˜å–è§„åˆ™**
- **é˜Ÿåˆ—ï¼ˆFIFOï¼‰**  
  å…ˆè¿›å…¥çš„æ•°æ®å…ˆè¢«å–å‡ºï¼Œå°±åƒæ’é˜Ÿä¹°ç¥¨ï¼š
  ```python
  from collections import deque
  q = deque()
  q.append(1)  # é˜Ÿå°¾å…¥é˜Ÿ -> [1]
  q.append(2)  # é˜Ÿå°¾å…¥é˜Ÿ -> [1, 2]
  q.popleft()  # é˜Ÿé¦–å‡ºé˜Ÿ -> è¿”å› 1ï¼Œå‰©ä½™ [2]
  ```

- **æ ˆï¼ˆLIFOï¼‰**  
  åè¿›å…¥çš„æ•°æ®å…ˆè¢«å–å‡ºï¼Œå°±åƒå ç›˜å­ï¼š
  ```python
  stack = []
  stack.append(1)  # å…¥æ ˆ -> [1]
  stack.append(2)  # å…¥æ ˆ -> [1, 2]
  stack.pop()      # å‡ºæ ˆ -> è¿”å› 2ï¼Œå‰©ä½™ [1]
  ```

---

### **(2) æ“ä½œç«¯ä¸åŒ**
| æ“ä½œ   | é˜Ÿåˆ—                  | æ ˆ                   |
|--------|-----------------------|----------------------|
| **æ’å…¥** | `append()`ï¼ˆé˜Ÿå°¾ï¼‰    | `append()`ï¼ˆæ ˆé¡¶ï¼‰   |
| **åˆ é™¤** | `popleft()`ï¼ˆé˜Ÿé¦–ï¼‰   | `pop()`ï¼ˆæ ˆé¡¶ï¼‰      |

> ğŸ“Œ Python ä¸­å¯ä»¥ç”¨ `deque` å®ç°é˜Ÿåˆ—å’Œæ ˆï¼Œä½†æ ˆç›´æ¥ç”¨ `list` æ›´ç®€å•ã€‚

---

### **(3) å¯è§†åŒ–å¯¹æ¯”**
#### **é˜Ÿåˆ—ï¼ˆFIFOï¼‰**
```
è¾“å…¥é¡ºåºï¼šA â†’ B â†’ C
è¾“å‡ºé¡ºåºï¼šA â†’ B â†’ C
```
```
é˜Ÿå°¾å…¥é˜Ÿ â†’ [C, B, A] â†’ é˜Ÿé¦–å‡ºé˜Ÿ
```

#### **æ ˆï¼ˆLIFOï¼‰**
```
è¾“å…¥é¡ºåºï¼šA â†’ B â†’ C
è¾“å‡ºé¡ºåºï¼šC â†’ B â†’ A
```
```
æ ˆé¡¶å…¥æ ˆ â†’ [A, B, C] â†’ æ ˆé¡¶å‡ºæ ˆ
```

---

## **2. å…¸å‹åº”ç”¨åœºæ™¯**
### **é˜Ÿåˆ—çš„ç”¨é€”**
1. **å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰**  
   ```python
   from collections import deque
   def bfs(graph, start):
       visited, q = set(), deque([start])
       while q:
           node = q.popleft()
           for neighbor in graph[node]:
               if neighbor not in visited:
                   visited.add(neighbor)
                   q.append(neighbor)
   ```
2. **ä»»åŠ¡è°ƒåº¦**ï¼ˆå¦‚æ‰“å°ä»»åŠ¡é˜Ÿåˆ—ï¼‰  
3. **æ¶ˆæ¯é˜Ÿåˆ—**ï¼ˆå¦‚ RabbitMQã€Kafkaï¼‰

### **æ ˆçš„ç”¨é€”**
1. **å‡½æ•°è°ƒç”¨æ ˆ**  
   ```python
   def func1():
       func2()  # è°ƒç”¨ func2 æ—¶ï¼Œfunc1 çš„ä¸Šä¸‹æ–‡å…¥æ ˆ
   def func2():
       pass
   func1()
   ```
2. **æ‹¬å·åŒ¹é…**  
   ```python
   def is_valid(s: str) -> bool:
       stack = []
       pairs = {")": "(", "]": "[", "}": "{"}
       for char in s:
           if char in pairs.values():
               stack.append(char)
           elif stack and stack[-1] == pairs[char]:
               stack.pop()
       return not stack
   ```
3. **æµè§ˆå™¨å‰è¿›/åé€€**  

---

## **3. å®ç°æ–¹å¼å¯¹æ¯”**
### **é˜Ÿåˆ—çš„å®ç°**
- **Pythonæ¨è**ï¼š`collections.deque`ï¼ˆé«˜æ•ˆåŒç«¯é˜Ÿåˆ—ï¼‰  
  ```python
  from collections import deque
  q = deque()
  q.append(1)      # å…¥é˜Ÿ
  q.popleft()      # å‡ºé˜Ÿ
  ```
- **ä¸æ¨è**ï¼šç”¨ `list.pop(0)`ï¼ˆæ—¶é—´å¤æ‚åº¦ `O(n)`ï¼Œæ€§èƒ½å·®ï¼‰

### **æ ˆçš„å®ç°**
- **Pythonæ¨è**ï¼šç›´æ¥ä½¿ç”¨ `list`  
  ```python
  stack = []
  stack.append(1)  # å…¥æ ˆ
  stack.pop()      # å‡ºæ ˆ
  ```
- ä¹Ÿå¯ä»¥ç”¨ `deque`ï¼Œä½†æ— å¿…è¦ã€‚

---

## **4. å¸¸è§é¢è¯•é¢˜**
### **é˜Ÿåˆ—ç›¸å…³é—®é¢˜**
1. ç”¨é˜Ÿåˆ—å®ç°æ ˆï¼ˆLeetCode 225ï¼‰
2. ç”¨æ ˆå®ç°é˜Ÿåˆ—ï¼ˆLeetCode 232ï¼‰
3. æ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼ˆLeetCode 239ï¼‰

### **æ ˆç›¸å…³é—®é¢˜**
1. æœ‰æ•ˆçš„æ‹¬å·ï¼ˆLeetCode 20ï¼‰
2. æœ€å°æ ˆï¼ˆLeetCode 155ï¼‰
3. é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼ï¼ˆLeetCode 150ï¼‰

---

## **æ€»ç»“**
- **é˜Ÿåˆ—**ï¼šå…ˆå…¥å…ˆå‡ºï¼ˆFIFOï¼‰ï¼Œé€‚ç”¨äºé¡ºåºå¤„ç†ï¼ˆå¦‚ BFSï¼‰ã€‚  
- **æ ˆ**ï¼šåå…¥å…ˆå‡ºï¼ˆLIFOï¼‰ï¼Œé€‚ç”¨äºå›é€€æ“ä½œï¼ˆå¦‚é€’å½’ã€æ‹¬å·åŒ¹é…ï¼‰ã€‚  
- **Python é€‰æ‹©**ï¼š  
  - é˜Ÿåˆ— â†’ `collections.deque`  
  - æ ˆ â†’ `list`  

ç†è§£ä¸¤è€…çš„åŒºåˆ«èƒ½å¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°è§£å†³ç®—æ³•é—®é¢˜ï¼ ğŸš€